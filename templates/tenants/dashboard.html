{% extends 'layouts/dashboard.html' %}
{% load static %}

{% block title %}Tenants Dashboard - EduERP{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h4 class="mb-4">Tenant Management</h4>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-xl-4">
    <div class="col">
        <div class="card radius-10 bg-gradient-cosmic">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-auto">
                        <p class="mb-0 text-white">Total Tenants</p>
                        <h4 class="my-1 text-white">{{ total_tenants|default:"0" }}</h4>
                    </div>
                    <div class="fs-1 text-white"><i class="bx bx-buildings"></i></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card radius-10 bg-gradient-ibiza">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-auto">
                        <p class="mb-0 text-white">Active Tenants</p>
                        <h4 class="my-1 text-white">{{ active_tenants|default:"0" }}</h4>
                    </div>
                    <div class="fs-1 text-white"><i class="bx bx-check-circle"></i></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card radius-10 bg-gradient-ohhappiness">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-auto">
                        <p class="mb-0 text-white">Trial Tenants</p>
                        <h4 class="my-1 text-white">{{ trial_tenants|default:"0" }}</h4>
                    </div>
                    <div class="fs-1 text-white"><i class="bx bx-time"></i></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card radius-10 bg-gradient-kyoto">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-auto">
                        <p class="mb-0 text-dark">Suspended</p>
                        <h4 class="my-1 text-dark">{{ suspended_tenants|default:"0" }}</h4>
                    </div>
                    <div class="text-dark fs-1"><i class="bx bx-block"></i></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-3 g-3 mt-4">
    <div class="col">
        <div class="card radius-10 border shadow-none mb-0">
            <div class="card-body text-center">
                <div class="widgets-icons rounded-circle bg-light-info text-info mx-auto mb-3">
                    <i class='bx bx-user-voice'></i>
                </div>
                <h5>Global Users</h5>
                <p class="mb-3 text-secondary">Manage all system users across tenants.</p>
                <a href="{% url 'tenants:global_user_list' %}" class="btn btn-outline-info btn-sm radius-30">View Users</a>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card radius-10 border shadow-none mb-0">
            <div class="card-body text-center">
                <div class="widgets-icons rounded-circle bg-light-danger text-danger mx-auto mb-3">
                    <i class='bx bxs-user-detail'></i>
                </div>
                <h5>Global Students</h5>
                <p class="mb-3 text-secondary">Cross-tenant student record lookup.</p>
                <a href="{% url 'tenants:global_student_list' %}" class="btn btn-outline-danger btn-sm radius-30">View Students</a>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card radius-10 border shadow-none mb-0">
            <div class="card-body text-center">
                <div class="widgets-icons rounded-circle bg-light-warning text-warning mx-auto mb-3">
                    <i class='bx bx-notification'></i>
                </div>
                <h5>System Broadcast</h5>
                <p class="mb-3 text-secondary">Notify tenants about updates or maintenance.</p>
                <a href="{% url 'tenants:notification_list' %}" class="btn btn-outline-warning btn-sm radius-30">Manage Alerts</a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card radius-10">
            <div class="card-header bg-transparent border-bottom-0">
                <div class="d-flex align-items-center">
                    <div>
                        <h6 class="mb-0">Tenant Statistics</h6>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table mb-0 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Tenant Name</th>
                                <th>Schema</th>
                                <th>Onboarding Status</th>
                                <th>Total Users</th>
                                <th>Total Students</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in tenant_stats %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="ms-2">
                                            <h6 class="mb-0 font-14">{{ stat.name }}</h6>
                                        </div>
                                    </div>
                                </td>
                                <td><code>{{ stat.schema_name }}</code></td>
                                <td>
                                    {% if stat.onboarding_status == 'PENDING' %}<span class="badge bg-warning text-dark">Pending</span>
                                    {% elif stat.onboarding_status == 'PROVISIONING' %}<span class="badge bg-info">Provisioning</span>
                                    {% elif stat.onboarding_status == 'READY' %}<span class="badge bg-success">Ready</span>
                                    {% elif stat.onboarding_status == 'FAILED' %}<span class="badge bg-danger">Failed</span>
                                    {% else %}<span class="badge bg-secondary">{{ stat.onboarding_status }}</span>{% endif %}
                                </td>
                                <td><span class="badge bg-light-info text-info">{{ stat.user_count }}</span></td>
                                <td><span class="badge bg-light-danger text-danger">{{ stat.student_count }}</span></td>
                                <td>
                                    <a href="{% url 'tenants:tenant_detail' stat.pk %}" class="btn btn-sm btn-outline-primary radius-30">Details</a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center">No active tenants found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12 col-lg-6">
        <div class="card radius-10">
            <div class="card-header bg-transparent">
                <h6 class="mb-0">Platform Administration</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'tenants:tenant_create' %}" class="btn btn-primary"><i class="bx bx-plus-circle me-2"></i>Add New Tenant</a>
                    <a href="{% url 'tenants:tenant_list' %}" class="btn btn-outline-primary"><i class="bx bx-list-ul me-2"></i>View All Tenants</a>
                    <a href="{% url 'tenants:domain_list' %}" class="btn btn-outline-secondary"><i class="bx bx-globe me-2"></i>Manage Domains</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
